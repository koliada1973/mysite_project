{% extends "credit_system/base.html" %}
{% load static %}
{% block page_title %}–î–µ—Ç–∞–ª—ñ –∫–ª—ñ—î–Ω—Ç–∞{% endblock %}

{% block content %}
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
                <strong>{{ client.last_name }} {{ client.first_name }} {{ client.middle_name }}</strong>
            </h4>
        </div>

        <div class="card-body">
            <div class="card shadow-sm mb-3">

                {# –ó–∞–≥–æ–ª–æ–≤–æ–∫, —â–æ –≤–∏–∫–æ–Ω—É—î —Ñ—É–Ω–∫—Ü—ñ—é –∫–Ω–æ–ø–∫–∏ (—Ä–æ–∑–∫—Ä–∏–≤–∞—î –∞–±–æ —Å–∫—Ä–∏–≤–∞—î –¥–∞–Ω—ñ) #}
                <div class="card-header p-0" id="headingOne">
                    <button class="btn btn-block w-100 text-start fw-bold text-primary p-3"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapseOne"
                            aria-expanded="true"
                            aria-controls="collapseOne">
                        ‚ÑπÔ∏è –û—Å–Ω–æ–≤–Ω—ñ –¥–∞–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∞ —Ç–∞ –ø–∞—Å–ø–æ—Ä—Ç–Ω—ñ –¥–∞–Ω—ñ
                    </button>
                </div>

                {# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä, —è–∫–∏–π –∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è/—Ä–æ–∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è #}
                <div id="collapseOne" class="collapse" aria-labelledby="headingOne">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm detail-table mb-0">
                                <tbody>
                                    <tr class="table-header">
                                        <td colspan="2" class="fw-bold bg-light">–û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</td>
                                        <td colspan="2" class="fw-bold bg-light">–ü–∞—Å–ø–æ—Ä—Ç–Ω—ñ –¥–∞–Ω—ñ</td>
                                    </tr>

                                    <tr>
                                        <th style="width: 20%;">–Ü–ü–ù</th>
                                        <td style="width: 30%;">{{ client.IPN }}</td>
                                        <th style="width: 20%;">–°–µ—Ä—ñ—è</th>
                                        <td style="width: 30%;">{{ client.passport_series }}</td>
                                    </tr>
                                    <tr>
                                        <th>–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</th>
                                        <td>{{ client.date_of_birth|date:"d.m.Y" }}</td>
                                        <th>–ù–æ–º–µ—Ä</th>
                                        <td>{{ client.passport_number }}</td>
                                    </tr>
                                    <tr>
                                        <th>–ú—ñ—Å—Ü–µ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</th>
                                        <td>{{ client.place_of_birth }}</td>
                                        <th>–û—Ä–≥–∞–Ω, —â–æ –≤–∏–¥–∞–≤</th>
                                        <td>{{ client.passport_vidan }}</td>
                                    </tr>
                                    <tr>
                                        <th>–°—Ç–∞—Ç—å</th>
                                        <td>
                                            {% if client.sex == 'm' %}–ß–æ–ª–æ–≤—ñ—á–∞{% elif client.sex == 'w' %}–ñ—ñ–Ω–æ—á–∞{% endif %}
                                        </td>
                                        <th>–î–∞—Ç–∞ –≤–∏–¥–∞—á—ñ</th>
                                        <td>{{ client.passport_date|date:"d.m.Y" }}</td>
                                    </tr>
                                    <tr>
                                        <th>–ê–¥—Ä–µ—Å–∞ –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è</th>
                                        <td>{{ client.address_residential }}</td>
                                        <th>–ê–¥—Ä–µ—Å–∞ –ø—Ä–æ–ø–∏—Å–∫–∏</th>
                                        <td>{{ client.address_registration }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            {# –ë–õ–û–ö 2: –†–û–ë–û–¢–ê, –ö–û–ù–¢–ê–ö–¢–ò –¢–ê –ù–û–¢–ê–¢–ö–ò #}
            <div class="card shadow-sm mb-3">

                {# –ó–∞–≥–æ–ª–æ–≤–æ–∫, —â–æ –≤–∏–∫–æ–Ω—É—î —Ñ—É–Ω–∫—Ü—ñ—é –∫–Ω–æ–ø–∫–∏ (—Ä–æ–∑–∫—Ä–∏–≤–∞—î –∞–±–æ —Å–∫—Ä–∏–≤–∞—î –¥–∞–Ω—ñ) #}
                <div class="card-header p-0" id="headingTwo">
                    <button class="btn btn-block w-100 text-start fw-bold text-primary p-3 collapsed"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapseTwo"
                            aria-expanded="false"
                            aria-controls="collapseTwo">
                        üíº –†–æ–±–æ—Ç–∞, –∫–æ–Ω—Ç–∞–∫—Ç–∏ —Ç–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
                    </button>
                </div>

                {# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä, —è–∫–∏–π –∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è/—Ä–æ–∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è #}
                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm detail-table mb-0">
                                <tbody>
                                    <tr class="table-header">
                                        <td colspan="2" class="fw-bold bg-light">–†–æ–±–æ—Ç–∞</td>
                                        <td colspan="2" class="fw-bold bg-light">–ö–æ–Ω—Ç–∞–∫—Ç–∏</td>
                                    </tr>
                                    <tr>
                                        <th style="width: 20%;">–ú—ñ—Å—Ü–µ —Ä–æ–±–æ—Ç–∏</th>
                                        <td style="width: 30%;">{{ client.work_place }}</td>
                                        <th style="width: 20%;">–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                        <td style="width: 30%;">{{ client.phone_number }}</td>
                                    </tr>
                                    <tr>
                                        <th>–ü–æ—Å–∞–¥–∞</th>
                                        <td>{{ client.position }}</td>
                                        <th>Email</th>
                                        <td>{{ client.email }}</td>
                                    </tr>

                                    <tr>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <td>
                                            {% if client.is_active %}
                                                <span class="badge bg-warning text-dark">–ê–∫—Ç–∏–≤–Ω–∏–π</span>
                                            {% else %}
                                                <span class="badge bg-success">–ù–µ –∞–∫—Ç–∏–≤–Ω–∏–π</span>
                                            {% endif %}
                                        </td>
                                        <td colspan="2"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        {# –ë–ª–æ–∫ –ù–æ—Ç–∞—Ç–æ–∫ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—É –¥—Ä—É–≥–æ–≥–æ –∑–≥–æ—Ä—Ç–∞—é—á–æ–≥–æ—Å—è –±–ª–æ–∫—É #}
                        {% if client.notes %}
                        <div class="p-3">
                            <div class="card border-secondary">
                                <div class="card-header bg-light text-primary fw-bold">
                                    –ù–æ—Ç–∞—Ç–∫–∏
                                </div>
                                <div class="card-body">
                                    <p class="mb-0" style="white-space: pre-line;">{{ client.notes }}</p>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                    </div>
                </div>
            </div>


            {% if credits %}
                <div class="card mt-4 shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">–ö—Ä–µ–¥–∏—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞</h5>
                    </div>
                    <div class="card-body p-0">
                        <table class="table table-bordered table-hover table-sm mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>–ù–æ–º–µ—Ä</th>
                                    <th>–°—É–º–∞</th>
                                    <th>–î–∞—Ç–∞ –≤–∏–¥–∞—á—ñ</th>
                                    <th>–ó–∞–ª–∏—à–æ–∫</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
{#                                    <th></th>#}
                                </tr>
                            </thead>
                            <tbody>
                            {% for credit in credits %}
                                <tr>
{#                                    <td>{{ credit.number }}</td>#}
                                    <td>
{#                                        <a href="{% url 'credit_detail' credit.pk %}" class="text-decoration-none fw-bold text-primary">#}
{#                                            {{ credit.number }}#}
{#                                        </a>#}
                                        <a href="{% url 'credit_detail' credit.pk %}?next=client_detail" class="text-decoration-none fw-bold text-primary">{{ credit.number }}</a>
                                    </td>
                                    <td>{{ credit.summa_credit }} –≥—Ä–Ω</td>
                                    <td>{{ credit.start_date|date:"d.m.Y" }}</td>
                                    <td>{{ credit.ostatok }} –≥—Ä–Ω</td>
                                    <td>
                                        {% if credit.closed %}
                                            <span class="badge bg-success">–ó–∞–∫—Ä–∏—Ç–æ</span>
                                        {% else %}
                                            <span class="badge bg-warning text-dark">–ê–∫—Ç–∏–≤–Ω–∏–π</span>
                                        {% endif %}
                                    </td>
{#                                    <td>#}
{#                                        <a href="{% url 'credit_detail' credit.id %}" class="btn btn-primary btn-sm">#}
{#                                            –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏#}
{#                                        </a>#}
{#                                    </td>#}
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            {% else %}
                <div class="alert alert-info mt-4">–£ —Ü—å–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞ —â–µ –Ω–µ–º–∞—î –∫—Ä–µ–¥–∏—Ç—ñ–≤.</div>
            {% endif %}


        </div>

        <div class="card-footer bg-white border-0 d-flex justify-content-between">

            <div class="back-button">
                {% with source=request.GET.source %}
                    {% if source == 'credits' %}
                        <a href="{% url 'all_credits_list' %}" class="btn btn-secondary">
                            < –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ —Å–ø–∏—Å–∫—É –∫—Ä–µ–¥–∏—Ç—ñ–≤
                        </a>
                    {% elif source == 'clients' %}
                        <a href="{% url 'all_clients_list' %}" class="btn btn-secondary">
                            < –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ —Å–ø–∏—Å–∫—É –∫–ª—ñ—î–Ω—Ç—ñ–≤
                        </a>
                    {% else %}
                        <a href="{% url 'all_credits_list' %}" class="btn btn-secondary">
                            < –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ —Å–ø–∏—Å–∫—É –∫—Ä–µ–¥–∏—Ç—ñ–≤
                        </a>
                    {% endif %}
                {% endwith %}
            </div>

            {% if user.is_manager or user.is_superuser %}
                <div class="add-button">
                    <a href="{% url 'add_new_credit' client.pk %}" class="btn btn-success">
                        –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –∫—Ä–µ–¥–∏—Ç
                    </a>
                </div>
            {% endif %}
        </div>

    </div>
{% endblock %}